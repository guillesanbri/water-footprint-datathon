import os
import numpy as np

reading_eq_zero = [272, 323, 461, 549, 1225, 1261, 1506, 1837, 1896, 2001, 2089, 2135, 2231, 2369, 2542, 2544, 2545,
                   2547, 2690]

reading_lt_zero = [1041, 2711]

delta_lt_zero = [3, 7, 9, 14, 19, 23, 32, 39, 56, 57, 58, 59, 72, 76, 80, 81, 88, 91, 95, 96, 102, 109, 119, 136, 137,
                 138, 147, 153, 155, 157, 167, 172, 189, 198, 201, 204, 206, 212, 216, 217, 232, 256, 269, 270, 273,
                 281, 285, 297, 298, 301, 303, 308, 310, 312, 316, 318, 323, 325, 327, 328, 337, 357, 365, 368, 373,
                 374, 378, 379, 380, 381, 383, 389, 394, 395, 398, 399, 419, 433, 450, 454, 457, 459, 465, 471, 473,
                 477, 478, 479, 482, 487, 489, 493, 496, 498, 503, 507, 514, 524, 533, 540, 551, 552, 554, 555, 556,
                 557, 564, 565, 576, 584, 587, 590, 595, 596, 600, 608, 615, 621, 629, 630, 635, 636, 647, 653, 654,
                 662, 667, 669, 674, 675, 678, 683, 686, 689, 690, 692, 694, 695, 698, 703, 705, 716, 717, 720, 731,
                 735, 738, 742, 743, 751, 758, 760, 763, 771, 774, 776, 778, 783, 790, 792, 794, 796, 801, 802, 804,
                 810, 814, 817, 818, 823, 829, 838, 840, 841, 844, 845, 852, 858, 866, 873, 881, 882, 887, 891, 892,
                 895, 896, 897, 898, 899, 903, 907, 911, 913, 914, 924, 925, 926, 934, 937, 939, 941, 944, 947, 948,
                 949, 953, 962, 977, 979, 986, 1002, 1012, 1021, 1027, 1031, 1039, 1041, 1046, 1047, 1055, 1059, 1069,
                 1072, 1076, 1080, 1100, 1102, 1105, 1106, 1107, 1115, 1122, 1124, 1144, 1148, 1149, 1152, 1156, 1164,
                 1166, 1182, 1195, 1204, 1208, 1216, 1218, 1226, 1234, 1235, 1239, 1248, 1250, 1253, 1261, 1271, 1272,
                 1274, 1279, 1280, 1281, 1295, 1297, 1299, 1301, 1308, 1311, 1321, 1324, 1326, 1336, 1338, 1363, 1365,
                 1370, 1373, 1374, 1380, 1388, 1399, 1401, 1406, 1407, 1412, 1414, 1415, 1419, 1420, 1432, 1433, 1436,
                 1451, 1453, 1456, 1458, 1462, 1468, 1469, 1480, 1481, 1483, 1487, 1489, 1494, 1495, 1497, 1505, 1506,
                 1514, 1524, 1526, 1527, 1537, 1538, 1540, 1543, 1545, 1551, 1555, 1560, 1566, 1567, 1585, 1586, 1589,
                 1592, 1595, 1611, 1613, 1619, 1623, 1627, 1630, 1634, 1641, 1651, 1657, 1661, 1663, 1670, 1679, 1690,
                 1699, 1702, 1709, 1713, 1719, 1720, 1722, 1725, 1730, 1732, 1736, 1739, 1747, 1756, 1761, 1762, 1772,
                 1774, 1775, 1778, 1779, 1780, 1790, 1791, 1792, 1795, 1799, 1801, 1802, 1804, 1813, 1823, 1826, 1829,
                 1833, 1845, 1859, 1864, 1869, 1873, 1874, 1876, 1884, 1893, 1898, 1900, 1906, 1911, 1912, 1915, 1920,
                 1922, 1924, 1925, 1927, 1928, 1935, 1938, 1953, 1960, 1962, 1967, 1972, 1978, 1979, 1980, 1990, 1991,
                 1995, 1996, 2009, 2016, 2019, 2021, 2028, 2039, 2042, 2043, 2044, 2048, 2051, 2063, 2082, 2088, 2090,
                 2093, 2103, 2108, 2110, 2121, 2128, 2139, 2140, 2142, 2152, 2157, 2164, 2177, 2191, 2201, 2205, 2206,
                 2212, 2216, 2222, 2224, 2225, 2235, 2249, 2252, 2273, 2274, 2275, 2276, 2277, 2278, 2281, 2282, 2298,
                 2310, 2311, 2316, 2318, 2321, 2324, 2331, 2333, 2339, 2345, 2353, 2405, 2421, 2429, 2459, 2498, 2551,
                 2556, 2572, 2585, 2586, 2600, 2632, 2641, 2711]

end_before_01feb20 = [116, 167, 209, 231, 260, 293, 371, 386, 438, 441, 525, 654, 795, 813, 860, 969, 1022, 1133, 1174,
                      1247, 1338, 1367, 1501, 1585, 1661, 1663, 1755, 1758, 1780, 1783, 1799, 1860, 1893, 1933, 1966,
                      1981, 1994, 1997, 2041, 2116, 2142, 2202, 2207, 2260, 2265, 2408, 2410, 2412, 2414, 2418, 2419,
                      2420, 2423, 2424, 2428, 2433, 2435, 2438, 2439, 2441, 2442, 2451, 2452, 2453, 2484, 2491, 2492,
                      2493, 2508, 2510, 2514, 2517, 2518, 2521, 2522, 2523, 2524, 2525, 2526, 2527, 2528, 2529, 2530,
                      2531, 2532, 2536, 2537, 2538, 2539, 2540, 2543, 2557, 2569, 2604, 2605, 2618, 2631, 2690, 2713,
                      2714, 2716, 2719, 2720, 2721, 2722, 2723, 2742, 2743, 2744, 2745, 2746, 2747, 2748, 2749, 2756]

start_after_01feb19 = [23, 26, 32, 34, 35, 39, 54, 62, 72, 74, 76, 78, 79, 85, 113, 116, 135, 136, 145, 155, 159, 167,
                       185, 192, 193, 199, 203, 206, 209, 226, 231, 233, 234, 237, 242, 243, 279, 299, 311, 312, 316,
                       322, 323, 345, 347, 360, 404, 414, 418, 420, 426, 438, 449, 450, 455, 457, 461, 472, 476, 478,
                       489, 493, 514, 526, 549, 557, 565, 571, 577, 581, 595, 605, 622, 624, 626, 630, 655, 659, 661,
                       664, 671, 700, 712, 725, 737, 746, 762, 775, 777, 782, 795, 807, 813, 815, 824, 825, 833, 872,
                       880, 884, 885, 899, 914, 918, 931, 937, 938, 950, 953, 981, 996, 997, 1018, 1043, 1064, 1069,
                       1072, 1119, 1133, 1135, 1138, 1141, 1152, 1170, 1174, 1178, 1182, 1187, 1193, 1210, 1222, 1225,
                       1233, 1236, 1244, 1253, 1258, 1261, 1278, 1314, 1324, 1333, 1336, 1342, 1366, 1372, 1401, 1409,
                       1417, 1423, 1425, 1427, 1429, 1445, 1446, 1447, 1449, 1493, 1503, 1507, 1514, 1530, 1546, 1556,
                       1567, 1579, 1620, 1622, 1632, 1646, 1669, 1672, 1674, 1678, 1679, 1683, 1701, 1710, 1737, 1745,
                       1748, 1759, 1766, 1777, 1778, 1784, 1796, 1802, 1803, 1806, 1814, 1815, 1830, 1834, 1835, 1837,
                       1847, 1848, 1852, 1868, 1873, 1893, 1947, 1961, 1966, 1974, 1975, 1976, 1996, 2001, 2023, 2029,
                       2035, 2037, 2057, 2089, 2098, 2112, 2116, 2123, 2126, 2135, 2138, 2151, 2163, 2175, 2185, 2201,
                       2202, 2207, 2221, 2231, 2248, 2250, 2254, 2256, 2260, 2271, 2272, 2274, 2275, 2280, 2299, 2307,
                       2315, 2327, 2356, 2369, 2384, 2396, 2403, 2409, 2410, 2411, 2414, 2416, 2418, 2422, 2423, 2427,
                       2428, 2433, 2435, 2436, 2437, 2438, 2439, 2441, 2442, 2517, 2518, 2519, 2520, 2521, 2522, 2523,
                       2524, 2525, 2526, 2527, 2528, 2529, 2530, 2531, 2532, 2533, 2534, 2535, 2536, 2537, 2538, 2539,
                       2540, 2541, 2542, 2543, 2544, 2545, 2546, 2547, 2548, 2549, 2550, 2551, 2552, 2553, 2554, 2555,
                       2556, 2557, 2558, 2559, 2560, 2561, 2562, 2563, 2564, 2565, 2566, 2567, 2568, 2569, 2570, 2571,
                       2572, 2573, 2574, 2575, 2576, 2577, 2578, 2579, 2580, 2581, 2582, 2583, 2584, 2585, 2586, 2587,
                       2588, 2589, 2590, 2591, 2592, 2593, 2594, 2595, 2596, 2597, 2598, 2599, 2600, 2601, 2602, 2603,
                       2604, 2605, 2606, 2607, 2608, 2609, 2610, 2611, 2612, 2613, 2614, 2615, 2616, 2617, 2618, 2619,
                       2620, 2621, 2622, 2623, 2624, 2625, 2626, 2627, 2628, 2629, 2630, 2631, 2632, 2633, 2634, 2635,
                       2636, 2637, 2638, 2639, 2640, 2641, 2642, 2643, 2644, 2645, 2646, 2647, 2648, 2649, 2650, 2651,
                       2652, 2653, 2654, 2655, 2656, 2657, 2658, 2659, 2660, 2661, 2662, 2663, 2664, 2665, 2666, 2667,
                       2668, 2669, 2670, 2671, 2672, 2673, 2674, 2675, 2676, 2677, 2678, 2679, 2680, 2681, 2682, 2683,
                       2684, 2685, 2686, 2687, 2688, 2689, 2690, 2691, 2692, 2693, 2694, 2695, 2696, 2697, 2698, 2699,
                       2700, 2701, 2702, 2703, 2704, 2705, 2706, 2707, 2708, 2709, 2710, 2711, 2712, 2713, 2714, 2715,
                       2716, 2717, 2718, 2719, 2720, 2721, 2722, 2723, 2724, 2725, 2727, 2728, 2729, 2730, 2731, 2732,
                       2733, 2734, 2735, 2736, 2737, 2739, 2742, 2743, 2744, 2745, 2746, 2747, 2748, 2749, 2756]

validation_ids_v1 = ['0531', '1811', '0415', '2294', '1232', '0865', '1529', '0424', '1731', '1522',
                     '0070', '0660', '1786', '1104', '2165', '1215', '2017', '1832', '1696', '0765',
                     '1717', '1968', '1190', '1393', '1082', '2038', '1382', '0546', '1812', '0591',
                     '1937', '1943', '0806', '1856', '1086', '2300', '1765', '1062', '0718', '0951',
                     '0048', '2358', '0160', '1726', '0335', '0828', '2018', '1609', '1032', '2342',
                     '0889', '2065', '0784', '0069', '2462', '1616', '0115', '0044', '1988', '1624',
                     '1473', '1053', '1025', '1664', '2415', '1254', '2247', '1658', '0307', '0839',
                     '2025', '0797', '2220', '0134', '1323', '1186', '1464', '1185', '1390', '2124',
                     '0580', '0589', '2218', '0029', '1885', '2074', '0593', '0755', '1478', '1376',
                     '1017', '1691', '1971', '1089', '0767', '0836', '0108', '2332', '0049', '0999']


def get_all_ids(id_dir):
    return [f[:4] for f in os.listdir(id_dir) if f[-3:] == "csv"]


lists = [
    reading_eq_zero,
    reading_lt_zero,
    delta_lt_zero,
    end_before_01feb20,
    start_after_01feb19,
]

if __name__ == "__main__":
    print("Num of IDs with any kind of problem:", end=" ")
    sets = [set(x) for x in lists]
    num_files = len(set().union(*sets))
    print(num_files)

    files = os.listdir("../Data/water_meters")
    files = np.array([f[:4] for f in files if f[-3:] == "csv"])


    def is_valid(x):
        x = int(x)
        for l in lists:
            if x in l:
                return False
        return True


    files = [f for f in files if is_valid(f)]
    choices = np.random.choice(files, 100, replace=False)
    print(choices)
